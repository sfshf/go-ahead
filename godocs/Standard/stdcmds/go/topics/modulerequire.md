
[Maintaining module requirements](https://golang.google.cn/cmd/go/#hdr-Maintaining_module_requirements)


##### 说明：

`go.mod`文件有意让程序员和工具都可以读取和编辑它。`go命令`本身会自动更新`go.mod`文件以维护标准格式和`require`语句的准确性。

发现不熟悉的导入项的`go命令`都将自动查找包含该导入项的模块并添加导入项的模块的最新版本到`go.mod`文件中。因此，在大多数情况下，向源代码添加导入并运行`go build`、`go test`甚至`go list`就足够了：作为分析包的一部分，`go命令`将发现并解析导入并更新`go.mod`文件。

任何`go命令`都可以检查出缺少的一个模块需求，并且必须添加它，即使只考虑模块中的一个包也是如此。另一方面，可以检查出某个模块需求不再是必需的，并且可以被删除，这需要对模块中的所有包进行全面的查看，包括所有可能的构建配置（architectures（架构）、operating systems（操作系统）、build tags（构建标记）等等）。`go mod tidy`命令构建该视图，然后添加任何缺少的模块需求并删除不必要的需求。

作为维护`go.mod`文件中`require`语句的一部分，`go命令`跟踪那些模块提供了包给当前模块直接导入，哪些模块提供了包给其他模块依赖间接使用的。仅用于间接使用的需求在`go.mod`文件中以`// indirect`注释标记。间接的需求会从`go.mod`文件中自动被删除，一旦被其他直接需求所隐含。间接需求只在使用某类模块时出现，这类模块没有声明它们自己的一些依赖关系，或者在模块自身声明的需求之前显式地升级模块的依赖关系。

因为这种自动维护，在`go.mod`文件中的信息是对构建的一个最新的、可读的描述。

`go get`命令通过更新`go.mod`文件来更改构建中使用的模块版本。一个模块的升级可能意味着其他模块的升级，同样，一个模块的降级可能意味着其他模块的降级。`go get`命令也进行这些隐含的更改。如果`go.mod`文件是直接编辑的，像`go build`或`go list`这样的命令会假定有升级的意图，并自动进行任何暗示的升级和更新`go.mod`文件来反映它们。

`go mod`命令提供了用于维护和理解模块与`go.mod`文件的其他功能。参见`go help mod`。

`-mod`构建标志提供了对`go.mod`文件的更新和使用的额外控制。

如果使用了`-mod=readonly`，`go命令`则不允许对`go.mod`文件进行上面介绍的隐式自动更新；取而代之的是，它也会失败，即使`go.mod`文件中的更改是必需的。这个设置对检查`go.mod`文件是否需要更新非常有用，比如在持续集成和测试系统中。`go get`命令在使用了`-mod=readonly`时仍然允许更新`go.mod`文件，`go mod`命令不会使用`-mod`标志(或任何其他构建标志)。

如果使用`-mod=vendor`调用，`go命令`假设`vendor`目录保存依赖项的正确副本，并且忽略`go.mod`文件中的依赖项描述。
